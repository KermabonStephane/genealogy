package com.genai.genealogy.gedcom


import spock.lang.Specification

class AnselSpec extends Specification {

    def "should read a GEDCOM file with ANSEL encoding"() {
        given:
        def reader = new GedcomReader()
        
        def anselBytes = [
            0x30, 0x20, 0x48, 0x45, 0x41, 0x44, 0x0D, 0x0A,             // 0 HEAD
            0x31, 0x20, 0x43, 0x48, 0x41, 0x52, 0x20, 0x41, 0x4E, 0x53, 0x45, 0x4C, 0x0D, 0x0A, // 1 CHAR ANSEL
            0x30, 0x20, 0x40, 0x49, 0x31, 0x40, 0x20, 0x49, 0x4E, 0x44, 0x49, 0x0D, 0x0A,       // 0 @I1@ INDI
            0x31, 0x20, 0x4E, 0x41, 0x4D, 0x45, 0x20, 0x52, 0xE2, 0x65, 0x6E, 0xE2, 0x65, 0x0D, 0x0A, // 1 NAME Rée née
            0x30, 0x20, 0x54, 0x52, 0x4C, 0x52, 0x0D, 0x0A              // 0 TRLR
        ] as byte[]
        
        def inputStream = new ByteArrayInputStream(anselBytes)

        when:
        def gedcom = reader.read(inputStream)

        then:
        gedcom != null
        gedcom.header != null
        gedcom.header.encoding == "ANSEL"
        def john = gedcom.individuals["I1"]
        john.name != null
        john.id == "I1"
    }
}
